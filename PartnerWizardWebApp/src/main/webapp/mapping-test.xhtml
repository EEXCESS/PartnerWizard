<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:syn="http://richfaces.org/sandbox/syntaxhighlighter"
	>

<body>
	<ui:composition template="/templates/template.xhtml">

		<ui:define name="title">EEXCESS PartnerRecommender Setup</ui:define>

		<ui:define name="body">
			<h:form styleClass="form-horizontal" id="formID">

				<fieldset>
					<!-- Form Name -->
					<legend>Parameter</legend>

					<!-- Text input-->
					<div class="control-group">
						<label class="control-label" for="textinput">groupId:</label>
						<div class="controls">
							<h:inputText value="#{bean.groupId}" styleClass="form-control" />
							<p class="help-block">id used in the Maven-Repository (e.g eu.eexcess)</p>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label" for="textinput">artifactId:</label>
						<div class="controls">
							<h:inputText value="#{bean.artifactId}" styleClass="form-control" />
							<p class="help-block">id used in the Maven-Repository (e.g MyPR)</p>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label" for="textinput">version:</label>
						<div class="controls">
							<h:inputText value="#{bean.version}" styleClass="form-control" />
							<p class="help-block">version used in the Maven-Repository (e.g 1.0)</p>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label" for="textinput">package:</label>
						<div class="controls">
							<h:inputText value="#{bean.packageStr}" styleClass="form-control" />
							<p class="help-block">java package, can be the same as the groupId (e.g eu.eexcess)</p>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label" for="textinput">partnerName:</label>
						<div class="controls">
							<h:inputText value="#{bean.partnerName}" styleClass="form-control" />
							<p class="help-block">Name of the Partner</p>
						</div>
					</div>
				</fieldset>

				<fieldset>
					<!-- Form Name -->
					<legend>Partner API</legend>

					<!-- Text input-->
					<div class="control-group">
						<label class="control-label" for="textinput">searchEndpoint:</label>
						<div class="controls">
							<h:inputText value="#{bean.searchEndpoint}" styleClass="form-control" />
							<p class="help-block">URL for API</p>
						</div>
					</div>

					<!-- Text input-->
					<div class="control-group">
						<label class="control-label" for="textinput">search term:</label>
						<div class="controls">
							<h:inputText value="#{bean.searchEndpointSearchTerm}" styleClass="form-control" />
							<p class="help-block">search term</p>
						</div>
					</div>
				</fieldset>
				<a4j:commandButton value="Call API" execute="@form"
				action="#{bean.callPartnerAPI}" styleClass="btn btn-primary" render="apiResponseId"/>
				
			<div class="row">
							<div>
								<h2>API Response</h2>
								<a4j:outputPanel id="apiResponseId">
								<!-- 
								<p>TODO: Show here XML Reponse from the API Call</p>
								<h:outputText value="#{bean.apiResponse}" escape="false"></h:outputText>
			-->
			
			<!-- 
								<h:inputTextarea rows="50" cols="80" value="#{bean.apiResponseFormated}" readonly="true"/>
			-->
<!-- 								<div style="max-height: 550px;overflow-y:hidden;display: inline-block;max-width: 900px;"> -->
<!-- style="max-height: 450px;overflow-y:auto;display: inline-block;max-width: 800px;" -->
									<syn:syntaxhighlighter id="syn2" theme="Eclipse" language="xml" 
										highlight="2" tabsize="4" gutter="false" rendered="true" > 
											<h:outputText value="#{bean.apiResponseFormated}" />
									</syn:syntaxhighlighter>
									</a4j:outputPanel>
							
							</div>
							<div>
								<a4j:outputPanel id="mappingFieldsId">
									<h2>Mapping to EEXCESS fields</h2>
									<div class="control-group">
										<label class="control-label" for="textinput">XPath for the loop:</label>
										<div class="controls">
											<h:inputText value="#{bean.eexcessFieldsXPathLoop}" styleClass="form-control" />
											<p class="help-block">XPath for the loop</p>
										</div>
									</div>
									<h3>EEXCESS Fields </h3>
									<table class="eexcessMappingFieldsTable">
										<tr>
											<td>name
											</td>
											<td>description
											</td>
											<td>xpath
											</td>
											<td>value
											</td>
										</tr>
										<ui:repeat value="#{bean.mappingFields}" var="mappingField">
											<tr>
												<td>
													#{mappingField.name}
												</td>
												<td>
													#{mappingField.description}
												</td>
												<td>
													<table>
														<tr>
															<td style="border:none;">
																<h:inputText value="#{mappingField.xPath}" styleClass="form-control" />
															</td>
															<td style="border:none;">
															<!-- execute="@form" -->
																<a4j:commandButton value="test" render="mappingFieldsId" 
																	action="#{bean.probeXPath}" styleClass="btn btn-primary" >
																	<a4j:param value="#{mappingField.id}" assignTo="#{bean.actMappingFieldId}" />
																</a4j:commandButton>
															</td>
														</tr>
													</table>
												</td>
												<td>
													<h:inputText value="#{mappingField.exampleValue}" styleClass="form-control" />
												</td>
											</tr>
										</ui:repeat>
									</table>
								</a4j:outputPanel>
							</div>
			</div>
				
			<div class="row">
				<div>
					<h2>Create PartnerRecommender/project </h2>
					<a4j:commandButton value="Build" render="out" execute="@form"
						action="#{bean.buildPR}" styleClass="btn btn-primary" />
					
					<p>
						<b>mvn command:</b>
						<br/>
						<h:panelGroup id="out">
							<h:outputText value="#{bean.buildCMDHTML}"
								styleClass="outhello" />
						</h:panelGroup>
					</p>
				</div>
			</div>
		</h:form>

			<br />
			
			<br/>


		</ui:define>
	</ui:composition>
</body>
</html>